<!-- 
  ** DO NOT EDIT THIS FILE
  ** 
  ** This file was automatically generated. 
  ** 1) Make all changes to `README.yaml` 
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file. 
  -->
[![README Header][readme_header_img]][readme_header_link]

[![cloudopsworks][logo]](https://cloudops.works/)

# Terraform AWS VPN Site-to-Site Module




AWS VPN Site-to-Site Module for establishing secure VPN connections between on-premises networks and AWS VPCs. This module supports both VPN Gateway and Transit Gateway configurations, offering flexible routing options, tunnel redundancy, and automated VPN connection management with comprehensive monitoring capabilities.


---

This project is part of our comprehensive approach towards DevOps Acceleration. 
[<img align="right" title="Share via Email" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/ios-mail.svg"/>][share_email]
[<img align="right" title="Share on Google+" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-googleplus.svg" />][share_googleplus]
[<img align="right" title="Share on Facebook" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-facebook.svg" />][share_facebook]
[<img align="right" title="Share on Reddit" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-reddit.svg" />][share_reddit]
[<img align="right" title="Share on LinkedIn" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-linkedin.svg" />][share_linkedin]
[<img align="right" title="Share on Twitter" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-twitter.svg" />][share_twitter]


[![Terraform Open Source Modules](https://docs.cloudops.works/images/terraform-open-source-modules.svg)][terraform_modules]



It's 100% Open Source and licensed under the [APACHE2](LICENSE).







We have [*lots of terraform modules*][terraform_modules] that are Open Source and we are trying to get them well-maintained!. Check them out!






## Introduction

The AWS VPN Site-to-Site Terraform module simplifies the process of creating and managing secure VPN connections between your on-premises network and AWS infrastructure. It provides a robust solution for establishing encrypted tunnels, supporting both static and dynamic routing protocols, and ensures high availability through redundant VPN tunnels. The module is designed to work seamlessly with AWS Transit Gateway and VPN Gateway, making it ideal for both simple and complex network architectures.

## Usage


**IMPORTANT:** The `master` branch is used in `source` just as an example. In your code, do not pin to `master` because there may be breaking changes between releases.
Instead pin to the release tag (e.g. `?ref=vX.Y.Z`) of one of our [latest releases](https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site/releases).


To use this module with Terragrunt, create a terragrunt.hcl file with the following configuration:

```hcl
include "root" {
  path = find_in_parent_folders()
}

terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site.git?ref=v1.0.0"
}

inputs = {
  customer_gateway_ip    = "1.2.3.4"
  vpn_connection_type   = "ipsec.1"
  static_routes_only    = false
  transit_gateway_id    = "tgw-xxxxx"
  tags = {
    Environment = "production"
    Project     = "network"
  }
  settings = {
    alarms = {
      enabled = true              # Enable/disable CloudWatch alarms
      for_each_tunnel = false     # If true, creates separate alarms for each tunnel
      threshold = "1"             # Threshold value for the alarm (default: 1)
      sns_topics = ["topic-name"] # List of SNS topic names to notify
      sns_topic_arns = []        # List of SNS topic ARNs (alternative to sns_topics)
    }
  }
}
```

"settings" Variable details:
```
settings:
  alarms:
    enabled: true | false         # (optional) if true, creates alarms for the VPN
    priority: 2                   # (optional) priority of the alarm, default is 2
    for_each_tunnel: true | false # (optional) if true, creates alarms for each tunnel, default is false
    sns_topics:                   # (optional) list of SNS topics to send alarms to
      - topic1
      - topic2
    sns_topic_arns:               # (optional) list of SNS topic ARNs to send alarms to (if sns_topics is not used)
      - "arn:aws:sns:us-east-1:123456789012:topic1"
    threshold: 1 # (optional) threshold for the alarm, default is 1
  customer_gateway:
    enabled: true
    id: "cgw-12345678" # only required if you are using an existing customer gateway & enabled=false
    device_name: "device-name"
    bgp_asn: 65000
    bgp_asn_extended: 65000
    ip_address: "127.0.0.1"
    certificate_arn: "arn:aws:acm:us-east-1:123456789012:certificate/12345678-1234-1234-1234-123456789012"
  vpn_gateway:
    enabled: true
    id: "vgw-12345678" # only required if you are using an existing VPN gateway & enabled=false
    availability_zone: "us-east-1a"
  type: "ipsec.1"
  transit_gateway_id: "tgw-12345678"
  static_routes_only: true
  enable_acceleration: true
  local:
    ipv4_network_cidr: "x.x.x.x/x"
    ipv6_network_cidr: "xxxx:xxxx:xxxx::/x"
  remote:
    ipv4_network_cidr: "x.x.x.x/x"
    ipv6_network_cidr: "xxxx:xxxx:xxxx::/x"
  outside_ip_address_type: PublicIpv4 | PrivateIpv4
  tunnel_inside_ip_version: ipv4 | ipv6
  tunnel1:
    inside_cidr: "x.x.x.x/x"
    inside_ipv6_cidr: "xxxx:xxxx:xxxx::/x"
    preshared_key: "preshared-key"
    dpd_timeout_action: clear | none | restart
    dpd_timeout_seconds: 30
    enable_tunnel_lifecycle_control: true
    ike_versions: ["ikev1", "ikev2"]
    rekey_margin_time_seconds: 300
    rekey_fuzz_percentage: 100
    replay_window_size: 1024
    startup_action: start | add
    phase1:
      dh_group_numbers: [2, 14, 15]
      encryption_algorithms: ["aes128", "aes256"]
      integrity_algorithms: ["sha1", "sha256"]
      lifetime_seconds: 28800
    phase2:
      dh_group_numbers: [2, 14, 15]
      encryption_algorithms: ["aes128", "aes256"]
      integrity_algorithms: ["sha1", "sha256"]
      lifetime_seconds: 3600
    log:
      enabled: true
      cloudwatch_log_group_name: "vpn-logs" # Optional if not specified it creates new log group
      output_format: "json"
      retention_in_days: 30
  tunnel2:
    inside_cidr: "x.x.x.x/x"
    inside_ipv6_cidr: "xxxx:xxxx:xxxx::/x"
    preshared_key: "preshared-key"
    dpd_timeout_action: clear | none | restart
    dpd_timeout_seconds: 30
    enable_tunnel_lifecycle_control: true
    ike_versions: ["ikev1", "ikev2"]
    rekey_margin_time_seconds: 300
    rekey_fuzz_percentage: 100
    replay_window_size: 1024
    startup_action: start | add
    phase1:
      dh_group_numbers: [2, 14, 15]
      encryption_algorithms: ["aes128", "aes256"]
      integrity_algorithms: ["sha1", "sha256"]
      lifetime_seconds: 28800
    phase2:
      dh_group_numbers: [2, 14, 15]
      encryption_algorithms: ["aes128", "aes256"]
      integrity_algorithms: ["sha1", "sha256"]
      lifetime_seconds: 3600
    log:
      enabled: true
      cloudwatch_log_group_name: "vpn-logs" # Optional if not specified it creates new log group
      output_format: "json"
      retention_in_days: 30
```

## Quick Start

1. Ensure you have the following prerequisites:
   - AWS credentials configured
   - Terraform (>= 0.13)
   - Terragrunt installed

2. Create a new Terragrunt project directory:
   ```bash
   mkdir vpn-project
   cd vpn-project
   ```

3. Create a terragrunt.hcl file with the module configuration:
   ```hcl
   include "root" {
     path = find_in_parent_folders()
   }

   terraform {
     source = "git::https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site.git?ref=v1.0.0"
   }

   inputs = {
     customer_gateway_ip = "YOUR_ON_PREMISES_IP"
     vpn_connection_type = "ipsec.1"
     static_routes_only  = true
     static_routes       = ["10.0.0.0/16"]
   }
   ```

4. Initialize and apply the configuration:
   ```bash
   terragrunt init
   terragrunt plan
   terragrunt apply
   ```

5. After successful application, retrieve the VPN configuration for your on-premises device using the output values.


## Examples

### Basic VPN Connection with Transit Gateway
```hcl
include "root" {
  path = find_in_parent_folders()
}

terraform {
  source = "git::https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site.git?ref=v1.0.0"
}

inputs = {
  customer_gateway_ip   = "203.0.113.1"
  vpn_connection_type  = "ipsec.1"
  transit_gateway_id   = dependency.transit_gateway.outputs.transit_gateway_id
  static_routes_only   = true
  static_routes        = ["192.168.0.0/24"]
  tags = {
    Environment = "production"
  }
}
```



## Makefile Targets
```
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform/opentofu code
  tag                                 Tag the current version

```
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 5.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.82.2 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_tags"></a> [tags](#module\_tags) | cloudopsworks/tags/local | 1.0.9 |
| <a name="module_tgw_routes"></a> [tgw\_routes](#module\_tgw\_routes) | git::https://github.com/cloudopsworks/terraform-module-aws-transit-gateway-routes.git// | v1.0.2 |

## Resources

| Name | Type |
|------|------|
| [aws_cloudwatch_log_group.tunnel1](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) | resource |
| [aws_cloudwatch_log_group.tunnel2](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) | resource |
| [aws_cloudwatch_metric_alarm.tunnel1_status](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm) | resource |
| [aws_cloudwatch_metric_alarm.tunnel2_status](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm) | resource |
| [aws_cloudwatch_metric_alarm.vpn_status](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm) | resource |
| [aws_customer_gateway.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/customer_gateway) | resource |
| [aws_ec2_tag.this_tgw](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ec2_tag) | resource |
| [aws_vpn_connection.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_connection) | resource |
| [aws_vpn_connection_route.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_connection_route) | resource |
| [aws_vpn_gateway.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_gateway) | resource |
| [aws_vpn_gateway_attachment.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_gateway_attachment) | resource |
| [aws_vpn_gateway_route_propagation.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpn_gateway_route_propagation) | resource |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |
| [aws_sns_topic.vpn_status](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/sns_topic) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_extra_tags"></a> [extra\_tags](#input\_extra\_tags) | n/a | `map(string)` | `{}` | no |
| <a name="input_is_hub"></a> [is\_hub](#input\_is\_hub) | Establish this is a HUB or spoke configuration | `bool` | `false` | no |
| <a name="input_name"></a> [name](#input\_name) | The name of the VPN | `string` | `""` | no |
| <a name="input_name_prefix"></a> [name\_prefix](#input\_name\_prefix) | The prefix to use for the VPN name | `string` | `""` | no |
| <a name="input_org"></a> [org](#input\_org) | n/a | <pre>object({<br/>    organization_name = string<br/>    organization_unit = string<br/>    environment_type  = string<br/>    environment_name  = string<br/>  })</pre> | n/a | yes |
| <a name="input_settings"></a> [settings](#input\_settings) | The settings for the VPN | `any` | `{}` | no |
| <a name="input_spoke_def"></a> [spoke\_def](#input\_spoke\_def) | n/a | `string` | `"001"` | no |
| <a name="input_vpc"></a> [vpc](#input\_vpc) | The VPC ID to deploy the VPN into | `any` | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_vpn_connection_arn"></a> [vpn\_connection\_arn](#output\_vpn\_connection\_arn) | n/a |
| <a name="output_vpn_connection_customer_gateway_id"></a> [vpn\_connection\_customer\_gateway\_id](#output\_vpn\_connection\_customer\_gateway\_id) | n/a |
| <a name="output_vpn_connection_id"></a> [vpn\_connection\_id](#output\_vpn\_connection\_id) | n/a |
| <a name="output_vpn_connection_routes"></a> [vpn\_connection\_routes](#output\_vpn\_connection\_routes) | n/a |
| <a name="output_vpn_connection_telemetry"></a> [vpn\_connection\_telemetry](#output\_vpn\_connection\_telemetry) | n/a |
| <a name="output_vpn_connection_transit_gateway_attachment_id"></a> [vpn\_connection\_transit\_gateway\_attachment\_id](#output\_vpn\_connection\_transit\_gateway\_attachment\_id) | n/a |
| <a name="output_vpn_connection_transit_gateway_id"></a> [vpn\_connection\_transit\_gateway\_id](#output\_vpn\_connection\_transit\_gateway\_id) | n/a |
| <a name="output_vpn_connection_tunnel1_address"></a> [vpn\_connection\_tunnel1\_address](#output\_vpn\_connection\_tunnel1\_address) | n/a |
| <a name="output_vpn_connection_tunnel1_cgw_inside_address"></a> [vpn\_connection\_tunnel1\_cgw\_inside\_address](#output\_vpn\_connection\_tunnel1\_cgw\_inside\_address) | n/a |
| <a name="output_vpn_connection_tunnel1_preshared_key"></a> [vpn\_connection\_tunnel1\_preshared\_key](#output\_vpn\_connection\_tunnel1\_preshared\_key) | n/a |
| <a name="output_vpn_connection_tunnel1_vgw_inside_address"></a> [vpn\_connection\_tunnel1\_vgw\_inside\_address](#output\_vpn\_connection\_tunnel1\_vgw\_inside\_address) | n/a |
| <a name="output_vpn_connection_tunnel2_address"></a> [vpn\_connection\_tunnel2\_address](#output\_vpn\_connection\_tunnel2\_address) | n/a |
| <a name="output_vpn_connection_tunnel2_cgw_inside_address"></a> [vpn\_connection\_tunnel2\_cgw\_inside\_address](#output\_vpn\_connection\_tunnel2\_cgw\_inside\_address) | n/a |
| <a name="output_vpn_connection_tunnel2_preshared_key"></a> [vpn\_connection\_tunnel2\_preshared\_key](#output\_vpn\_connection\_tunnel2\_preshared\_key) | n/a |
| <a name="output_vpn_connection_tunnel2_vgw_inside_address"></a> [vpn\_connection\_tunnel2\_vgw\_inside\_address](#output\_vpn\_connection\_tunnel2\_vgw\_inside\_address) | n/a |
| <a name="output_vpn_connection_vpn_gateway_id"></a> [vpn\_connection\_vpn\_gateway\_id](#output\_vpn\_connection\_vpn\_gateway\_id) | n/a |



## Help

**Got a question?** We got answers. 

File a GitHub [issue](https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site/issues), send us an [email][email] or join our [Slack Community][slack].

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## DevOps Tools

## Slack Community


## Newsletter

## Office Hours

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site/issues) to report any bugs or file feature requests.

### Developing




## Copyrights

Copyright Â© 2024-2025 [Cloud Ops Works LLC](https://cloudops.works)





## License 

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0) 

See [LICENSE](LICENSE) for full details.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.









## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [Cloud Ops Works LLC][website]. 


### Contributors

|  [![Cristian Beraha][berahac_avatar]][berahac_homepage]<br/>[Cristian Beraha][berahac_homepage] |
|---|

  [berahac_homepage]: https://github.com/berahac
  [berahac_avatar]: https://github.com/berahac.png?size=50

[![README Footer][readme_footer_img]][readme_footer_link]
[![Beacon][beacon]][website]

  [logo]: https://cloudops.works/logo-300x69.svg
  [docs]: https://cowk.io/docs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=docs
  [website]: https://cowk.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=website
  [github]: https://cowk.io/github?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=github
  [jobs]: https://cowk.io/jobs?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=jobs
  [hire]: https://cowk.io/hire?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=hire
  [slack]: https://cowk.io/slack?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=slack
  [linkedin]: https://cowk.io/linkedin?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=linkedin
  [twitter]: https://cowk.io/twitter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=twitter
  [testimonial]: https://cowk.io/leave-testimonial?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=testimonial
  [office_hours]: https://cloudops.works/office-hours?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=office_hours
  [newsletter]: https://cowk.io/newsletter?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=newsletter
  [email]: https://cowk.io/email?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=email
  [commercial_support]: https://cowk.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=commercial_support
  [we_love_open_source]: https://cowk.io/we-love-open-source?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=we_love_open_source
  [terraform_modules]: https://cowk.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=terraform_modules
  [readme_header_img]: https://cloudops.works/readme/header/img
  [readme_header_link]: https://cloudops.works/readme/header/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=readme_header_link
  [readme_footer_img]: https://cloudops.works/readme/footer/img
  [readme_footer_link]: https://cloudops.works/readme/footer/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=readme_footer_link
  [readme_commercial_support_img]: https://cloudops.works/readme/commercial-support/img
  [readme_commercial_support_link]: https://cloudops.works/readme/commercial-support/link?utm_source=github&utm_medium=readme&utm_campaign=cloudopsworks/terraform-module-aws-vpn-site-to-site&utm_content=readme_commercial_support_link
  [share_twitter]: https://twitter.com/intent/tweet/?text=Terraform+AWS+VPN+Site-to-Site+Module&url=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [share_linkedin]: https://www.linkedin.com/shareArticle?mini=true&title=Terraform+AWS+VPN+Site-to-Site+Module&url=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [share_reddit]: https://reddit.com/submit/?url=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [share_facebook]: https://facebook.com/sharer/sharer.php?u=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [share_googleplus]: https://plus.google.com/share?url=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [share_email]: mailto:?subject=Terraform+AWS+VPN+Site-to-Site+Module&body=https://github.com/cloudopsworks/terraform-module-aws-vpn-site-to-site
  [beacon]: https://ga-beacon.cloudops.works/G-7XWMFVFXZT/cloudopsworks/terraform-module-aws-vpn-site-to-site?pixel&cs=github&cm=readme&an=terraform-module-aws-vpn-site-to-site
